version: '3.8'
networks:
  moneyMinder-network:
    driver: bridge

services:
  moneyMinder-backend:
    image: gangeunlee/moneyminder-backend:latest
    container_name: moneyMinder-backend
    restart: always
    ports:
      - "8080:8080"
    volumes:
      - /home/ec2-user/backend/log:/app/moneyMinder/log
    networks:
      - moneyMinder-network

  moneyMinder-frontend:
    image: gangeunlee/moneyminder-frontend:latest
    container_name: moneyMinder-frontend
    restart: always
    ports:
      - "3001:80"
    networks:
      - moneyMinder-network

  nginx:
    image: nginx:alpine  # nginx:alpine 이미지를 사용
    container_name: moneyMinder-nginx
    restart: always
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /home/ec2-user/moneyminder/config/deploy/nginx.conf:/etc/nginx/nginx.conf:ro  # 정확한 nginx.conf 경로를 확인
      - /home/ec2-user/cert-backup/live:/etc/letsencrypt/live  # 인증서 마운트
    networks:
      - moneyMinder-network
